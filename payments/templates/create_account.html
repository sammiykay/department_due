{% load static %}
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Student account</title>
    <link rel="stylesheet" href="{% static 'assets/css/fontawe.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.output.css'%}" />
    <link rel="stylesheet" href="{% static 'assets/css/the_tailwind.css'%}" />
    <link rel="stylesheet" href="{% static 'assets/css/mycss.css'%}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.output.css' %}" />
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="{% static 'assets/js/init-alpine.js' %}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" defer></script>
    <script src="{% static 'assets/js/charts-lines.js' %}" defer></script>
    <script src="{% static 'assets/js/charts-pie.js' %}" defer></script>
</head>

<body>
    <form id="CreateForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="flex items-center min-h-screen p-6 bg-gray-50 dark:bg-gray-900">
            <div class="flex-1 h-full max-w-4xl mx-auto overflow-hidden bg-white rounded-lg shadow-xl dark:bg-gray-800">
                <div class="flex flex-col overflow-y-auto md:flex-row">
                    <div class="h-32 md:h-auto md:w-1/2">
                        <img aria-hidden="true" class="object-cover w-full h-full dark:hidden"
                            src="{% static 'assets/img/login-office.jpg' %}" alt="Office" />
                        <img aria-hidden="true" class="hidden object-cover w-full h-full dark:block"
                            src="{% static 'assets/img/create-account-office-dark.jpeg' %}" alt="Office" />
                    </div>
                    <div class="flex items-center justify-center p-6 sm:p-12 md:w-1/2">
                        <div class="w-full">
                            <h1 class="mb-4 text-xl font-semibold text-gray-700 dark:text-gray-200">
                                Create student account
                            </h1>
                            <label class="block text-sm">
                                <span class="text-gray-700 dark:text-gray-400">Matric number</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    name="username" type="number" placeholder="Enter matric number" />
                            </label>
                            <label class="block mt-4 text-sm"></label>
                                <span class="text-gray-700 dark:text-gray-400">Full name</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="Enter your full name" name="name" />
                            </label>
                            <label class="block mt-4 text-sm">
                                <span class="text-gray-700 dark:text-gray-400">Email</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="Enter email address" type="email" name="email" />
                            </label>

                            <label class="block mt-4 text-sm">
                                <span class="text-gray-700 dark:text-gray-400">Faculty</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="Enter Faculty" type="text" name="faculty" />
                            </label>
                            <label class="block mt-4 text-sm">
                                <span class="text-gray-700 dark:text-gray-400">Department</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="Enter Department" type="text" name="department" />
                            </label>
                            <label class="block mt-4 text-sm">
                                <span class="text-gray-700 dark:text-gray-400">Password</span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="***************" type="password" name="password1" />
                            </label>
                            <label class="block mt-4 text-sm">
                                <span class="text-gray-700 dark:text-gray-400">
                                    Confirm password
                                </span>
                                <input
                                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                                    placeholder="***************" name="password2" type="password" />
                            </label>
                            <div class="flex items-center mt-4 space-x-6">
                                <div class="shrink-0">
                                    <img id='preview_img' class="h-16 w-16 object-cover rounded-full"
                                        src="https://lh3.googleusercontent.com/a-/AFdZucpC_6WFBIfaAbPHBwGM9z8SxyM1oV4wB4Ngwp_UyQ=s96-c"
                                        alt="Current profile photo" />
                                </div>
                                <label class="block">
                                    <span class="sr-only text-purple-300">Choose profile photo</span>
                                    <input id="image" type="file" name="image" onchange="loadFile(event)" class="block w-full text-sm text-slate-500 text-purple-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-violet-50 file:text-violet-700
                                hover:file:bg-violet-100
                                
                            " 
                            required />
                                </label>
                            </div>

                            <!-- You should use a button here, as the anchor is only used for the example  -->
                            <button type="submit"
                                class="block w-full px-4 py-2 mt-4 text-sm font-medium leading-5 text-center text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                                Create account
                            </button>

                        </div>
                    </div>
                </div>
            </div>
            {{form}}

        </div>
    </form>
</body>
<!-- Latest jQuery version (3.x) from jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'assets/js/notification.min.js' %}"></script>

<script>
    var loadFile = function (event) {

        var input = event.target;
        var file = input.files[0];
        var type = file.type;

        var output = document.getElementById('preview_img');


        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function () {
            URL.revokeObjectURL(output.src) // free memory
        }
    };
    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

    $(document).ready(function(){
    $('#CreateForm').submit(function(event){
        event.preventDefault(); // Prevent default form submission
        var formData = new FormData();
        var name = $('input[name="name"]').val()
        console.log(name)
        var email = $('input[name="email"]').val()
        var username = $('input[name="username"]').val()
        var faculty = $('input[name="faculty"]').val()
        var department = $('input[name="department"]').val()
        var password1 = $('input[name="password1"]').val()
        var password2 = $('input[name="password2"]').val()
        var imageFile = $('#image')[0].files[0];
        // Append form fields to the FormData object
        formData.append('name', name);
        formData.append('email', email);
        formData.append('username', username);
        formData.append('faculty', faculty);
        formData.append('department', department);
        formData.append('password1', password1);
        formData.append('password2', password2);
        formData.append('image', imageFile);
        console.log(formData)

        $.ajax({
                method: 'POST',
                url: '{% url "signup" %}',
                headers: {'X-CSRFToken': csrftoken}, // Replace with your server endpoint
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                enctype: 'multipart/form-data',
                success: function(response) {
                    showNotification('success', response.status, response.message)
                    // Handle success (e.g., display success message)
                    // window.location.href = "{% url 'login' %}"
                },
                error: function(xhr, status, error) {
                    // Handle error (e.g., display error message)
                    console.log(status)
                    if (status === 'error') {
                        console.log(xhr)
                        let response = xhr.responseJSON;
                    showNotification('error', response.status, response.message)

                    }
                    else{
                        showNotification('error',"An error occur", error)

                    }
                }
            });
        
        // // var samplePaymentRequest = {
        // //     merchant_code: "MX007",          
        // //     pay_item_id: "101007",
        // //     txn_ref: "sample_txn_ref_123",
        // //     site_redirect_url: "https://google.com/",
        // //     amount: 10000, 
        // //     currency: 566, // ISO 4217 numeric code of the currency used
        // //     onComplete: paymentCallback,
        // //     mode: 'TEST'
        // // };
        // // window.webpayCheckout(samplePaymentRequest);
        // var formData = $(this).serialize(); // Serialize form data
    });
    });


</script>


</html>